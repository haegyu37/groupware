<!DOCTYPE html>
<html lang="ko">
<head>
  <title>문서 관리 페이지</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <meta charset="UTF-8">
</head>
<body>
<h1>문서 관리 페이지</h1>

<!-- 문서 작성 폼 -->
<h2>문서 작성</h2>
<form id="createDocumentForm">
  <label for="title">제목:</label>
  <input type="text" id="title" name="title" required><br>

  <label for="content">내용:</label>
  <textarea id="content" name="content" required></textarea><br>

  <label for="member">작성자:</label>
  <input type="text" id="member" name="member" required><br>

  <label for="tem">작성일자:</label>
  <input type="text" id="tem" name="tem" required><br>

  <button type="submit">작성</button>
</form>

<!-- 문서 목록 -->
<h2>문서 목록</h2>
<table>
  <thead>
  <tr>
    <th>ID</th>
    <th>제목</th>
    <th>내용</th>
    <th>작성자</th>
    <th>작성일자</th>
    <th>수정</th>
    <th>삭제</th>
  </tr>
  </thead>
  <tbody id="documentList"></tbody>
</table>

<script>
  // 문서 작성 폼 제출 이벤트 처리
  $('#createDocumentForm').submit(function (event) {
    event.preventDefault(); // 폼 기본 동작 방지

    let form = $(this);
    let title = form.find('#title').val();
    let content = form.find('#content').val();
    let member = form.find('#member').val();
    let tem = form.find('#tem').val();

    let documentData = {
      title: title,
      content: content,
      member: member,
      tem: tem
    };

    // 문서 작성 API 호출
    $.ajax({
      type: 'POST',
      url: '/documents',
      contentType: 'application/json',
      data: JSON.stringify(documentData),
      success: function () {
        // 문서 작성 성공
        form[0].reset(); // 폼 초기화
        loadDocumentList(); // 문서 목록 다시 로드
      },
      error: function (xhr, status, error) {
        console.error(error);
      }
    });
  });


  // 문서 삭제 이벤트 처리
  $(document).on('click', '.deleteButton', function () {
    let documentId = $(this).data('document-id');

    // 문서 삭제 API 호출
    $.ajax({
      type: 'DELETE',
      url: '/documents/' + documentId,
      success: function () {
        // 문서 삭제 성공
        loadDocumentList(); // 문서 목록 다시 로드
      },
      error: function (xhr, status, error) {
        console.error(error);
      }
    });
  });

  // 문서 목록 로드 함수
  function loadDocumentList() {
    // 문서 목록 API 호출
    $.ajax({
      type: 'GET',
      url: '/documents/list',
      success: function (response) {
        // 문서 목록 렌더링
        let documentList = $('#documentList');
        documentList.empty(); // 기존 목록 제거

        for (let i = 0; i < response.length; i++) {
          let document = response[i];

          let row = '<tr>' +
                  '<td>' + document.id + '</td>' +
                  '<td>' + document.title + '</td>' +
                  '<td>' + document.content + '</td>' +
                  '<td>' + document.member + '</td>' +
                  '<td>' + document.tem + '</td>' +
                  '<td><a href="/documents/' + document.id + '">수정</a></td>' +
                  '<td><button class="deleteButton" data-document-id="' + document.id + '">삭제</button></td>' +
                  '</tr>';

          documentList.append(row);
        }
      },
      error: function (xhr, status, error) {
        console.error(error);
      }
    });
  }

  // 페이지 로드 시 문서 목록 초기 로드
  loadDocumentList();
</script>
</body>
</html>
